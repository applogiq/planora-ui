import { useState } from 'react'
import { Card } from '../../components/ui/card'
import { Button } from '../../components/ui/button'
import { Badge } from '../../components/ui/badge'
import { Progress } from '../../components/ui/progress'
import { Avatar, AvatarFallback } from '../../components/ui/avatar'
import { Tabs, TabsContent, TabsList, TabsTrigger } from '../../components/ui/tabs'
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '../../components/ui/select'
import { Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription } from '../../components/ui/dialog'
import { Input } from '../../components/ui/input'
import { Textarea } from '../../components/ui/textarea'
import { Calendar as CalendarComponent } from '../../components/ui/calendar'
import { Popover, PopoverContent, PopoverTrigger } from '../../components/ui/popover'
import { Separator } from '../../components/ui/separator'
import { cn } from '../../components/ui/utils'
import { format } from 'date-fns'
import { toast } from 'sonner@2.0.3'
import { ProjectTemplates } from './ProjectTemplates'
import { projects as mockProjects, Project, getActiveProjects, getCompletedProjects, getOnHoldProjects } from '../../mock-data/projects'
import { 
  Plus, 
  Search, 
  Filter, 
  Calendar,
  Users,
  Target,
  Clock,
  MoreHorizontal,
  Folder,
  TrendingUp,
  AlertTriangle,
  GitBranch,
  Flag,
  Copy,
  Settings,
  FileText,
  Zap,
  BarChart3,
  Calendar as CalendarIcon,
  CheckCircle,
  PlayCircle,
  PauseCircle
} from 'lucide-react'

// Using centralized mock data
const projects = mockProjects.map(project => ({
  ...project,
  // Add any additional properties needed for the UI that aren't in the base Project interface
  methodology: project.tags.includes('agile') ? 'Agile' : 'Scrum',
  type: project.tags.includes('mobile') ? 'Mobile' : project.tags.includes('web') ? 'Web' : 'Software',
  teamSize: project.teamMembers.length + 1, // +1 for team lead
  tasksTotal: 25, // Default value, could be calculated from tasks
  tasksCompleted: Math.floor((project.progress / 100) * 25),
  issuesOpen: Math.floor(Math.random() * 5) + 1,
  upcomingMilestones: 2,
  recentActivity: project.lastUpdated,
  epics: Math.floor(Math.random() * 5) + 1,
  stories: Math.floor(Math.random() * 20) + 10,
  currentSprint: `Sprint ${Math.floor(Math.random() * 5) + 20}`,
  nextMilestone: 'Release v1.0',
  milestoneDue: project.endDate,
  version: 'v1.0.0',
  dependencies: []
})).slice(0, 8); // Take first 8 for the demo

// Note: Now using centralized mock data from src/mock-data/projects.ts
    description: 'Complete redesign of the main web application with new UI/UX',
    status: 'Active',
    priority: 'High',
    progress: 75,
    methodology: 'Scrum',
    type: 'Software Development',
    startDate: '2025-08-01',
    dueDate: '2025-10-15',
    budget: 50000,
    spent: 37500,
    owner: 'John Doe',
    team: [
      { name: 'John Doe', role: 'PM' },
      { name: 'Jane Smith', role: 'Designer' },
      { name: 'Rajesh Kumar', role: 'Frontend Developer' },
      { name: 'Mike Johnson', role: 'Backend Developer' }
    ],
    tasksCompleted: 18,
    totalTasks: 24,
    customer: 'Internal',
    epics: 3,
    stories: 12,
    currentSprint: 'Sprint 15',
    nextMilestone: 'Beta Release',
    milestoneDue: '2025-09-30',
    version: 'v2.0.0',
    dependencies: ['PROJ-003']
  },
  {
    id: 'PROJ-002',
    name: 'Mobile App Development',
    description: 'Native mobile app for iOS and Android platforms',
    status: 'Active',
    priority: 'Medium',
    progress: 65,
    methodology: 'Kanban',
    type: 'Software Development',
    startDate: '2025-09-15',
    dueDate: '2025-12-01',
    budget: 80000,
    spent: 35000,
    owner: 'Sarah Wilson',
    team: [
      { name: 'Sarah Wilson', role: 'PM' },
      { name: 'Rajesh Kumar', role: 'Mobile Developer' },
      { name: 'Tom Brown', role: 'iOS Developer' }
    ],
    tasksCompleted: 12,
    totalTasks: 20,
    customer: 'Acme Corp',
    epics: 2,
    stories: 8,
    currentSprint: 'Sprint 8',
    nextMilestone: 'MVP Release',
    milestoneDue: '2025-11-01',
    version: 'v1.0.0',
    dependencies: []
  },
  {
    id: 'PROJ-003',
    name: 'API Integration',
    description: 'Integration with third-party APIs and microservices',
    status: 'Active',
    priority: 'High',
    progress: 90,
    methodology: 'Waterfall',
    type: 'Infrastructure',
    startDate: '2025-07-01',
    dueDate: '2025-09-30',
    budget: 30000,
    spent: 28500,
    owner: 'Alex Chen',
    team: [
      { name: 'Alex Chen', role: 'Lead Dev' },
      { name: 'Rajesh Kumar', role: 'API Developer' },
      { name: 'Praveen Kumar', role: 'QA' }
    ],
    tasksCompleted: 27,
    totalTasks: 30,
    customer: 'Tech Solutions',
    epics: 1,
    stories: 6,
    currentSprint: null,
    nextMilestone: 'Production Deploy',
    milestoneDue: '2025-09-25',
    version: 'v1.2.0',
    dependencies: []
  },
  // In Progress Projects (7)
  {
    id: 'PROJ-004',
    name: 'E-commerce Platform',
    description: 'Building a scalable e-commerce platform with React and Node.js',
    status: 'In Progress',
    priority: 'High',
    progress: 45,
    methodology: 'Scrum',
    type: 'Software Development',
    startDate: '2025-08-15',
    dueDate: '2025-11-30',
    budget: 120000,
    spent: 45000,
    owner: 'Emma Davis',
    team: [
      { name: 'Emma Davis', role: 'PM' },
      { name: 'Rajesh Kumar', role: 'Full Stack Developer' },
      { name: 'Chris Lee', role: 'Backend Developer' },
      { name: 'Anna Wang', role: 'Designer' }
    ],
    tasksCompleted: 22,
    totalTasks: 50,
    customer: 'RetailCorp',
    epics: 4,
    stories: 18,
    currentSprint: 'Sprint 6',
    nextMilestone: 'Alpha Release',
    milestoneDue: '2025-10-15',
    version: 'v1.0.0-alpha',
    dependencies: []
  },
  {
    id: 'PROJ-005',
    name: 'Data Analytics Dashboard',
    description: 'Real-time analytics dashboard for business intelligence',
    status: 'In Progress',
    priority: 'Medium',
    progress: 35,
    methodology: 'Kanban',
    type: 'Analytics',
    startDate: '2025-09-01',
    dueDate: '2025-12-15',
    budget: 75000,
    spent: 25000,
    owner: 'David Kim',
    team: [
      { name: 'David Kim', role: 'PM' },
      { name: 'Rachel Green', role: 'Data Scientist' }
    ],
    tasksCompleted: 14,
    totalTasks: 40,
    customer: 'DataTech Inc',
    epics: 3,
    stories: 15,
    currentSprint: null,
    nextMilestone: 'POC Demo',
    milestoneDue: '2025-10-30',
    version: 'v0.1.0',
    dependencies: ['PROJ-003']
  },
  // Add more projects...
  {
    id: 'PROJ-006',
    name: 'Cloud Migration',
    description: 'Migrating legacy systems to AWS cloud infrastructure',
    status: 'In Progress',
    priority: 'High',
    progress: 60,
    methodology: 'Waterfall',
    type: 'Infrastructure',
    startDate: '2025-07-15',
    dueDate: '2025-10-31',
    budget: 95000,
    spent: 55000,
    owner: 'Michael Brown',
    team: [
      { name: 'Michael Brown', role: 'DevOps Lead' },
      { name: 'Sophie Chen', role: 'Cloud Architect' },
      { name: 'James Wilson', role: 'SysAdmin' }
    ],
    tasksCompleted: 18,
    totalTasks: 30,
    customer: 'Enterprise Solutions',
    epics: 2,
    stories: 10,
    currentSprint: null,
    nextMilestone: 'Phase 2 Migration',
    milestoneDue: '2025-10-15',
    version: 'v2.0.0',
    dependencies: []
  },
  // Completed Projects (2)
  {
    id: 'PROJ-011',
    name: 'Legacy System Upgrade',
    description: 'Upgrading legacy CRM system to modern architecture',
    status: 'Completed',
    priority: 'High',
    progress: 100,
    methodology: 'Waterfall',
    type: 'Infrastructure',
    startDate: '2025-05-01',
    dueDate: '2025-08-15',
    budget: 85000,
    spent: 82000,
    owner: 'Tech Lead',
    team: [
      { name: 'Andrew Miller', role: 'Tech Lead' },
      { name: 'Sarah Thompson', role: 'Developer' },
      { name: 'Mark Davis', role: 'DBA' }
    ],
    tasksCompleted: 45,
    totalTasks: 45,
    customer: 'Internal',
    epics: 3,
    stories: 15,
    currentSprint: null,
    nextMilestone: 'Project Closed',
    milestoneDue: '2025-08-15',
    version: 'v3.0.0',
    dependencies: []
  },
  {
    id: 'PROJ-012',
    name: 'Payment Gateway Integration',
    description: 'Integration with multiple payment gateways for global expansion',
    status: 'Completed',
    priority: 'Medium',
    progress: 100,
    methodology: 'Scrum',
    type: 'Software Development',
    startDate: '2025-06-01',
    dueDate: '2025-08-30',
    budget: 55000,
    spent: 53000,
    owner: 'Payment Team',
    team: [
      { name: 'Carlos Rodriguez', role: 'PM' },
      { name: 'Helen Zhang', role: 'Backend Dev' }
    ],
    tasksCompleted: 28,
    totalTasks: 28,
    customer: 'E-commerce Division',
    epics: 2,
    stories: 10,
    currentSprint: null,
    nextMilestone: 'Project Closed',
    milestoneDue: '2025-08-30',
    version: 'v1.5.0',
    dependencies: []
  }
]

interface ProjectsProps {
  onProjectSelect?: (projectId: string) => void
  user?: any
}

export function Projects({ onProjectSelect, user }: ProjectsProps) {
  const userRole = user?.role || 'developer'
  const isAdmin = userRole === 'admin'
  const isProjectManager = userRole === 'project_manager'
  const isDeveloperOrTester = userRole === 'developer' || userRole === 'tester'

  // Filter projects based on user role
  const getFilteredProjects = () => {
    if (isAdmin || isProjectManager) {
      return projects // Admins and PMs see all projects
    } else if (isDeveloperOrTester) {
      // Developers and testers only see projects they're assigned to
      return projects.filter(project => 
        project.team.some(member => member.name === user?.name)
      )
    }
    return projects
  }

  const roleFilteredProjects = getFilteredProjects()
  const [viewMode, setViewMode] = useState<'grid' | 'list'>('grid')
  const [selectedFilter, setSelectedFilter] = useState('all')
  const [showCreateProject, setShowCreateProject] = useState(false)
  const [showTemplateModal, setShowTemplateModal] = useState(false)
  const [selectedProject, setSelectedProject] = useState<string | null>(null)
  const [searchQuery, setSearchQuery] = useState('')
  const [filterBy, setFilterBy] = useState({
    status: 'all',
    priority: 'all',
    methodology: 'all',
    type: 'all'
  })
  const [newProject, setNewProject] = useState({
    name: '',
    description: '',
    methodology: '',
    type: '',
    priority: '',
    startDate: undefined as Date | undefined,
    dueDate: undefined as Date | undefined,
    budget: '',
    owner: '',
    customer: ''
  })

  const getStatusColor = (status: string) => {
    switch (status) {
      case 'Active': return 'text-[#28A745]'
      case 'In Progress': return 'text-[#FFC107]'
      case 'Completed': return 'text-[#007BFF]'
      case 'On Hold': return 'text-[#DC3545]'
      default: return 'text-muted-foreground'
    }
  }

  const filteredProjects = roleFilteredProjects.filter(project => {
    const matchesSearch = project.name.toLowerCase().includes(searchQuery.toLowerCase()) ||
                         project.description.toLowerCase().includes(searchQuery.toLowerCase()) ||
                         project.customer.toLowerCase().includes(searchQuery.toLowerCase())
    
    const matchesStatus = filterBy.status === 'all' || project.status === filterBy.status
    const matchesPriority = filterBy.priority === 'all' || project.priority === filterBy.priority
    const matchesMethodology = filterBy.methodology === 'all' || project.methodology === filterBy.methodology
    const matchesType = filterBy.type === 'all' || project.type === filterBy.type
    
    return matchesSearch && matchesStatus && matchesPriority && matchesMethodology && matchesType
  })

  const getPriorityColor = (priority: string) => {
    switch (priority) {
      case 'High': return 'bg-[#DC3545] text-white'
      case 'Medium': return 'bg-[#FFC107] text-white'
      case 'Low': return 'bg-[#28A745] text-white'
      default: return 'bg-muted text-foreground'
    }
  }

  const getBudgetStatus = (spent: number, budget: number) => {
    const percentage = (spent / budget) * 100
    if (percentage > 90) return { color: 'text-[#DC3545]', status: 'Over Budget' }
    if (percentage > 75) return { color: 'text-[#FFC107]', status: 'At Risk' }
    return { color: 'text-[#28A745]', status: 'On Track' }
  }

  const handleCreateProject = (e: React.FormEvent) => {
    e.preventDefault()
    if (!newProject.name.trim()) {
      toast.error('Project name is required')
      return
    }
    toast.success('Project created successfully!')
    setShowCreateProject(false)
    setNewProject({
      name: '', description: '', methodology: '', type: '', priority: '',
      startDate: undefined, dueDate: undefined, budget: '', owner: '', customer: ''
    })
  }

  const handleUseTemplate = (template: any) => {
    setNewProject({
      ...newProject,
      name: `${template.name} - ${new Date().toLocaleDateString()}`,
      description: template.description,
      methodology: template.methodology,
      type: template.type
    })
    setShowTemplateModal(false)
    setShowCreateProject(true)
  }

  const getMethodologyIcon = (methodology: string) => {
    switch (methodology) {
      case 'Scrum': return <Zap className="w-4 h-4" />
      case 'Kanban': return <BarChart3 className="w-4 h-4" />
      case 'Waterfall': return <GitBranch className="w-4 h-4" />
      default: return <Target className="w-4 h-4" />
    }
  }

  return (
    <div className="space-y-6">
      {/* Header */}
      <div className="flex items-center justify-between">
        <div>
          <h1 className="text-2xl font-semibold text-foreground">
            {isAdmin ? 'All Projects' : 
             isProjectManager ? 'Managed Projects' : 
             'My Projects'}
          </h1>
          <p className="text-muted-foreground">
            {isAdmin ? 'End-to-end project lifecycle management with Agile, Waterfall & Hybrid workflows' :
             isProjectManager ? 'Projects under your management and team collaboration' :
             'Your assigned projects and contributions'}
          </p>
        </div>
        <div className="flex items-center space-x-2">
          {/* Search Input */}
          <div className="relative">
            <Search className="w-4 h-4 absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground" />
            <Input
              placeholder="Search projects..."
              value={searchQuery}
              onChange={(e) => setSearchQuery(e.target.value)}
              className="pl-10 w-64"
            />
          </div>
          
          {/* Filter Dropdown */}
          <Popover>
            <PopoverTrigger asChild>
              <Button variant="outline" size="sm">
                <Filter className="w-4 h-4 mr-2" />
                Filter
              </Button>
            </PopoverTrigger>
            <PopoverContent className="w-80" align="end">
              <div className="space-y-4">
                <h4 className="font-medium leading-none">Filter Projects</h4>
                
                <div className="grid grid-cols-2 gap-3">
                  <div>
                    <label className="text-sm font-medium mb-1 block">Status</label>
                    <Select value={filterBy.status} onValueChange={(value) => setFilterBy({...filterBy, status: value})}>
                      <SelectTrigger className="h-8">
                        <SelectValue />
                      </SelectTrigger>
                      <SelectContent>
                        <SelectItem value="all">All Status</SelectItem>
                        <SelectItem value="Active">Active</SelectItem>
                        <SelectItem value="In Progress">In Progress</SelectItem>
                        <SelectItem value="Completed">Completed</SelectItem>
                      </SelectContent>
                    </Select>
                  </div>
                  
                  <div>
                    <label className="text-sm font-medium mb-1 block">Priority</label>
                    <Select value={filterBy.priority} onValueChange={(value) => setFilterBy({...filterBy, priority: value})}>
                      <SelectTrigger className="h-8">
                        <SelectValue />
                      </SelectTrigger>
                      <SelectContent>
                        <SelectItem value="all">All Priority</SelectItem>
                        <SelectItem value="High">High</SelectItem>
                        <SelectItem value="Medium">Medium</SelectItem>
                        <SelectItem value="Low">Low</SelectItem>
                      </SelectContent>
                    </Select>
                  </div>
                  
                  <div>
                    <label className="text-sm font-medium mb-1 block">Methodology</label>
                    <Select value={filterBy.methodology} onValueChange={(value) => setFilterBy({...filterBy, methodology: value})}>
                      <SelectTrigger className="h-8">
                        <SelectValue />
                      </SelectTrigger>
                      <SelectContent>
                        <SelectItem value="all">All Methods</SelectItem>
                        <SelectItem value="Scrum">Scrum</SelectItem>
                        <SelectItem value="Kanban">Kanban</SelectItem>
                        <SelectItem value="Waterfall">Waterfall</SelectItem>
                      </SelectContent>
                    </Select>
                  </div>
                  
                  <div>
                    <label className="text-sm font-medium mb-1 block">Type</label>
                    <Select value={filterBy.type} onValueChange={(value) => setFilterBy({...filterBy, type: value})}>
                      <SelectTrigger className="h-8">
                        <SelectValue />
                      </SelectTrigger>
                      <SelectContent>
                        <SelectItem value="all">All Types</SelectItem>
                        <SelectItem value="Software Development">Software Dev</SelectItem>
                        <SelectItem value="Infrastructure">Infrastructure</SelectItem>
                        <SelectItem value="Marketing">Marketing</SelectItem>
                        <SelectItem value="Analytics">Analytics</SelectItem>
                        <SelectItem value="Security">Security</SelectItem>
                      </SelectContent>
                    </Select>
                  </div>
                </div>
                
                <Button 
                  variant="outline" 
                  size="sm" 
                  className="w-full"
                  onClick={() => setFilterBy({status: 'all', priority: 'all', methodology: 'all', type: 'all'})}
                >
                  Clear Filters
                </Button>
              </div>
            </PopoverContent>
          </Popover>
          
          <Button variant="outline" size="sm" onClick={() => setShowTemplateModal(true)}>
            <FileText className="w-4 h-4 mr-2" />
            Templates
          </Button>
          <Button size="sm" className="bg-[#28A745] hover:bg-[#218838] text-white" onClick={() => setShowCreateProject(true)}>
            <Plus className="w-4 h-4 mr-2" />
            New Project
          </Button>
        </div>
      </div>

      {/* Tabs */}
      <Tabs defaultValue="overview" className="space-y-6">
        <TabsList className="grid w-full grid-cols-4">
          <TabsTrigger value="overview">Overview ({roleFilteredProjects.length})</TabsTrigger>
          <TabsTrigger value="active">Active ({roleFilteredProjects.filter(p => p.status === 'Active').length})</TabsTrigger>
          <TabsTrigger value="in-progress">In Progress ({roleFilteredProjects.filter(p => p.status === 'In Progress').length})</TabsTrigger>
          <TabsTrigger value="completed">Completed ({roleFilteredProjects.filter(p => p.status === 'Completed').length})</TabsTrigger>
        </TabsList>

        <TabsContent value="overview" className="space-y-6">
          {/* Project Stats */}
          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
            <Card className="p-6">
              <div className="flex items-center justify-between">
                <div>
                  <p className="text-sm font-medium text-muted-foreground">Total Projects</p>
                  <p className="text-2xl font-semibold">{roleFilteredProjects.length}</p>
                </div>
                <div className="p-3 bg-[#007BFF]/10 rounded-full">
                  <Folder className="w-6 h-6 text-[#007BFF]" />
                </div>
              </div>
            </Card>

            <Card className="p-6">
              <div className="flex items-center justify-between">
                <div>
                  <p className="text-sm font-medium text-muted-foreground">Active</p>
                  <p className="text-2xl font-semibold">{roleFilteredProjects.filter(p => p.status === 'Active').length}</p>
                </div>
                <div className="p-3 bg-[#28A745]/10 rounded-full">
                  <TrendingUp className="w-6 h-6 text-[#28A745]" />
                </div>
              </div>
            </Card>

            <Card className="p-6">
              <div className="flex items-center justify-between">
                <div>
                  <p className="text-sm font-medium text-muted-foreground">At Risk</p>
                  <p className="text-2xl font-semibold">1</p>
                </div>
                <div className="p-3 bg-[#FFC107]/10 rounded-full">
                  <AlertTriangle className="w-6 h-6 text-[#FFC107]" />
                </div>
              </div>
            </Card>

            <Card className="p-6">
              <div className="flex items-center justify-between">
                <div>
                  <p className="text-sm font-medium text-muted-foreground">Total Budget</p>
                  <p className="text-2xl font-semibold">$160k</p>
                </div>
                <div className="p-3 bg-[#DC3545]/10 rounded-full">
                  <Target className="w-6 h-6 text-[#DC3545]" />
                </div>
              </div>
            </Card>
          </div>

          {/* Projects Grid */}
          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            {filteredProjects.map((project) => {
              const budgetStatus = getBudgetStatus(project.spent, project.budget)
              
              return (
                <Card 
                  key={project.id} 
                  className="hover:shadow-lg transition-shadow cursor-pointer"
                  onClick={() => onProjectSelect?.(project.id)}
                >
                  <div className="p-4">
                    {/* Header */}
                    <div className="flex items-start justify-between mb-3">
                      <div className="flex-1">
                        <div className="flex items-center space-x-2 mb-1">
                          <h3 className="font-semibold">{project.name}</h3>
                          <Badge className={getPriorityColor(project.priority)}>
                            {project.priority}
                          </Badge>
                        </div>
                        <p className="text-sm text-muted-foreground line-clamp-2">
                          {project.description}
                        </p>
                        <div className="flex items-center space-x-3 mt-2">
                          <div className="flex items-center space-x-1 text-xs text-muted-foreground">
                            {getMethodologyIcon(project.methodology)}
                            <span>{project.methodology}</span>
                          </div>
                          <Badge variant="outline" className="text-xs">
                            {project.type}
                          </Badge>
                        </div>
                      </div>
                      <Button variant="ghost" size="sm" className="p-1">
                        <MoreHorizontal className="w-4 h-4" />
                      </Button>
                    </div>

                    {/* Progress */}
                    <div className="mb-3">
                      <div className="flex items-center justify-between mb-2">
                        <span className="text-sm font-medium">Progress</span>
                        <span className="text-sm text-muted-foreground">{project.progress}%</span>
                      </div>
                      <Progress value={project.progress} className="h-2" />
                    </div>

                    {/* Backlog Stats */}
                    <div className="grid grid-cols-3 gap-2 mb-3">
                      <div className="text-center p-2 bg-muted/30 rounded">
                        <p className="text-xs text-muted-foreground">Epics</p>
                        <p className="text-sm font-semibold">{project.epics}</p>
                      </div>
                      <div className="text-center p-2 bg-muted/30 rounded">
                        <p className="text-xs text-muted-foreground">Stories</p>
                        <p className="text-sm font-semibold">{project.stories}</p>
                      </div>
                      <div className="text-center p-2 bg-muted/30 rounded">
                        <p className="text-xs text-muted-foreground">Tasks</p>
                        <p className="text-sm font-semibold">{project.tasksCompleted}/{project.totalTasks}</p>
                      </div>
                    </div>

                    {/* Status & Budget */}
                    <div className="flex items-center justify-between">
                      <span className={`text-sm font-medium ${getStatusColor(project.status)}`}>
                        {project.status}
                      </span>
                      <span className={`text-xs ${budgetStatus.color}`}>
                        ${(project.spent/1000).toFixed(0)}k / ${(project.budget/1000).toFixed(0)}k
                      </span>
                    </div>
                  </div>
                </Card>
              )
            })}
          </div>
        </TabsContent>

        <TabsContent value="active" className="space-y-6">
          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            {filteredProjects.filter(p => p.status === 'Active').map((project) => {
              const budgetStatus = getBudgetStatus(project.spent, project.budget)
              
              return (
                <Card 
                  key={project.id} 
                  className="hover:shadow-lg transition-shadow cursor-pointer"
                  onClick={() => onProjectSelect?.(project.id)}
                >
                  <div className="p-4">
                    <div className="flex items-start justify-between mb-3">
                      <div className="flex-1">
                        <div className="flex items-center space-x-2 mb-1">
                          <h3 className="font-semibold">{project.name}</h3>
                          <Badge className={getPriorityColor(project.priority)}>
                            {project.priority}
                          </Badge>
                        </div>
                        <p className="text-sm text-muted-foreground line-clamp-2">
                          {project.description}
                        </p>
                      </div>
                    </div>
                    <div className="mb-3">
                      <div className="flex items-center justify-between mb-2">
                        <span className="text-sm font-medium">Progress</span>
                        <span className="text-sm text-muted-foreground">{project.progress}%</span>
                      </div>
                      <Progress value={project.progress} className="h-2" />
                    </div>
                  </div>
                </Card>
              )
            })}
          </div>
        </TabsContent>

        <TabsContent value="in-progress" className="space-y-6">
          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            {filteredProjects.filter(p => p.status === 'In Progress').map((project) => {
              const budgetStatus = getBudgetStatus(project.spent, project.budget)
              
              return (
                <Card 
                  key={project.id} 
                  className="hover:shadow-lg transition-shadow cursor-pointer"
                  onClick={() => onProjectSelect?.(project.id)}
                >
                  <div className="p-4">
                    <div className="flex items-start justify-between mb-3">
                      <div className="flex-1">
                        <div className="flex items-center space-x-2 mb-1">
                          <h3 className="font-semibold">{project.name}</h3>
                          <Badge className={getPriorityColor(project.priority)}>
                            {project.priority}
                          </Badge>
                        </div>
                        <p className="text-sm text-muted-foreground line-clamp-2">
                          {project.description}
                        </p>
                      </div>
                    </div>
                    <div className="mb-3">
                      <div className="flex items-center justify-between mb-2">
                        <span className="text-sm font-medium">Progress</span>
                        <span className="text-sm text-muted-foreground">{project.progress}%</span>
                      </div>
                      <Progress value={project.progress} className="h-2" />
                    </div>
                  </div>
                </Card>
              )
            })}
          </div>
        </TabsContent>

        <TabsContent value="completed" className="space-y-6">
          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            {filteredProjects.filter(p => p.status === 'Completed').map((project) => {
              const budgetStatus = getBudgetStatus(project.spent, project.budget)
              
              return (
                <Card 
                  key={project.id} 
                  className="hover:shadow-lg transition-shadow cursor-pointer"
                  onClick={() => onProjectSelect?.(project.id)}
                >
                  <div className="p-4">
                    <div className="flex items-start justify-between mb-3">
                      <div className="flex-1">
                        <div className="flex items-center space-x-2 mb-1">
                          <h3 className="font-semibold">{project.name}</h3>
                          <Badge className={getPriorityColor(project.priority)}>
                            {project.priority}
                          </Badge>
                        </div>
                        <p className="text-sm text-muted-foreground line-clamp-2">
                          {project.description}
                        </p>
                      </div>
                    </div>
                    <div className="mb-3">
                      <div className="flex items-center justify-between mb-2">
                        <span className="text-sm font-medium">Progress</span>
                        <span className="text-sm text-muted-foreground">{project.progress}%</span>
                      </div>
                      <Progress value={project.progress} className="h-2" />
                    </div>
                  </div>
                </Card>
              )
            })}
          </div>
        </TabsContent>
      </Tabs>

      {/* Project Template Modal - 1200px width */}
      <ProjectTemplates 
        isOpen={showTemplateModal} 
        onClose={() => setShowTemplateModal(false)}
        onSelectTemplate={handleUseTemplate}
      />

      {/* Create Project Dialog - Updated width to 1200px */}
      <Dialog open={showCreateProject} onOpenChange={setShowCreateProject}>
        <DialogContent className="w-[1200px] max-w-[1200px] max-h-[80vh] overflow-y-auto">
          <DialogHeader>
            <DialogTitle>Create New Project</DialogTitle>
            <DialogDescription>
              Set up your project with all the necessary details and configurations
            </DialogDescription>
          </DialogHeader>
          
          <form onSubmit={handleCreateProject} className="space-y-6">
            {/* Basic Information */}
            <div className="grid grid-cols-2 gap-6">
              <div className="space-y-2">
                <label className="text-sm font-medium">Project Name *</label>
                <Input
                  value={newProject.name}
                  onChange={(e) => setNewProject(prev => ({ ...prev, name: e.target.value }))}
                  placeholder="Enter project name"
                  required
                />
              </div>
              
              <div className="space-y-2">
                <label className="text-sm font-medium">Customer/Client</label>
                <Input
                  value={newProject.customer}
                  onChange={(e) => setNewProject(prev => ({ ...prev, customer: e.target.value }))}
                  placeholder="Enter customer name"
                />
              </div>
            </div>
            
            <div className="space-y-2">
              <label className="text-sm font-medium">Description</label>
              <Textarea
                value={newProject.description}
                onChange={(e) => setNewProject(prev => ({ ...prev, description: e.target.value }))}
                placeholder="Describe the project goals and objectives"
                rows={3}
              />
            </div>
            
            {/* Project Configuration */}
            <div className="grid grid-cols-3 gap-6">
              <div className="space-y-2">
                <label className="text-sm font-medium">Methodology</label>
                <Select value={newProject.methodology} onValueChange={(value) => setNewProject(prev => ({ ...prev, methodology: value }))}>
                  <SelectTrigger>
                    <SelectValue placeholder="Select methodology" />
                  </SelectTrigger>
                  <SelectContent>
                    <SelectItem value="Scrum">Scrum</SelectItem>
                    <SelectItem value="Kanban">Kanban</SelectItem>
                    <SelectItem value="Waterfall">Waterfall</SelectItem>
                    <SelectItem value="Hybrid">Hybrid</SelectItem>
                  </SelectContent>
                </Select>
              </div>
              
              <div className="space-y-2">
                <label className="text-sm font-medium">Project Type</label>
                <Select value={newProject.type} onValueChange={(value) => setNewProject(prev => ({ ...prev, type: value }))}>
                  <SelectTrigger>
                    <SelectValue placeholder="Select type" />
                  </SelectTrigger>
                  <SelectContent>
                    <SelectItem value="Software Development">Software Development</SelectItem>
                    <SelectItem value="Infrastructure">Infrastructure</SelectItem>
                    <SelectItem value="Marketing">Marketing</SelectItem>
                    <SelectItem value="Analytics">Analytics</SelectItem>
                    <SelectItem value="Security">Security</SelectItem>
                    <SelectItem value="Research">Research</SelectItem>
                  </SelectContent>
                </Select>
              </div>
              
              <div className="space-y-2">
                <label className="text-sm font-medium">Priority</label>
                <Select value={newProject.priority} onValueChange={(value) => setNewProject(prev => ({ ...prev, priority: value }))}>
                  <SelectTrigger>
                    <SelectValue placeholder="Select priority" />
                  </SelectTrigger>
                  <SelectContent>
                    <SelectItem value="High">High</SelectItem>
                    <SelectItem value="Medium">Medium</SelectItem>
                    <SelectItem value="Low">Low</SelectItem>
                  </SelectContent>
                </Select>
              </div>
            </div>
            
            {/* Timeline & Budget */}
            <div className="grid grid-cols-3 gap-6">
              <div className="space-y-2">
                <label className="text-sm font-medium">Start Date</label>
                <Popover>
                  <PopoverTrigger asChild>
                    <Button variant="outline" className="w-full justify-start text-left font-normal">
                      <CalendarIcon className="mr-2 h-4 w-4" />
                      {newProject.startDate ? format(newProject.startDate, 'MMM dd, yyyy') : 'Select date'}
                    </Button>
                  </PopoverTrigger>
                  <PopoverContent className="w-auto p-0" align="start">
                    <CalendarComponent
                      mode="single"
                      selected={newProject.startDate}
                      onSelect={(date) => setNewProject(prev => ({ ...prev, startDate: date }))}
                      initialFocus
                    />
                  </PopoverContent>
                </Popover>
              </div>
              
              <div className="space-y-2">
                <label className="text-sm font-medium">Due Date</label>
                <Popover>
                  <PopoverTrigger asChild>
                    <Button variant="outline" className="w-full justify-start text-left font-normal">
                      <CalendarIcon className="mr-2 h-4 w-4" />
                      {newProject.dueDate ? format(newProject.dueDate, 'MMM dd, yyyy') : 'Select date'}
                    </Button>
                  </PopoverTrigger>
                  <PopoverContent className="w-auto p-0" align="start">
                    <CalendarComponent
                      mode="single"
                      selected={newProject.dueDate}
                      onSelect={(date) => setNewProject(prev => ({ ...prev, dueDate: date }))}
                      initialFocus
                    />
                  </PopoverContent>
                </Popover>
              </div>
              
              <div className="space-y-2">
                <label className="text-sm font-medium">Budget ($)</label>
                <Input
                  type="number"
                  value={newProject.budget}
                  onChange={(e) => setNewProject(prev => ({ ...prev, budget: e.target.value }))}
                  placeholder="0"
                />
              </div>
            </div>
            
            <div className="space-y-2">
              <label className="text-sm font-medium">Project Owner</label>
              <Input
                value={newProject.owner}
                onChange={(e) => setNewProject(prev => ({ ...prev, owner: e.target.value }))}
                placeholder="Enter project owner name"
              />
            </div>
            
            <Separator />
            
            <div className="flex justify-end space-x-3">
              <Button type="button" variant="outline" onClick={() => setShowCreateProject(false)}>
                Cancel
              </Button>
              <Button type="submit" className="bg-[#28A745] hover:bg-[#218838]">
                Create Project
              </Button>
            </div>
          </form>
        </DialogContent>
      </Dialog>
    </div>
  )
}